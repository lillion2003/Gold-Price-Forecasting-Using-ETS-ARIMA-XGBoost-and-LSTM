# การทำนายราคาทองคำ: เปรียบเทียบวิธี Time Series กับ Machine Learning

**Author**: Github: lillion2003

เนื้อหานี้รวบรวมขั้นตอนการพยากรณ์ราคาทองคำโดยใช้วิธีการต่างๆ ทั้งวิธีอนุกรมเวลา (Time Series) และวิธีการเรียนรู้ของเครื่อง (Machine Learning) เพื่อประเมินประสิทธิภาพของแต่ละวิธีในการทำนายราคาทองคำภายใต้สถานการณ์สงครามรัสเซีย-ยูเครน

## สารบัญ (Table of Contents)

- [Problem](#problem)
- [Data](#data)
- [Methods](#methods)
- [Methodology](#methodology)
- [Results](#results)
- [Limitations](#limitations)
- [Recommendations & Next Steps](#recommendations--next-steps)
- [Project Structure](#project-structure)

## Problem

สงครามรัสเซีย–ยูเครนส่งผลกระทบต่อระบบเศรษฐกิจโลกอย่างมีนัยสำคัญ ทั้งด้านความไม่แน่นอนทางภูมิรัฐศาสตร์ มาตรการคว่ำบาตร ความผันผวนของราคาพลังงาน และแรงกดดันเงินเฟ้อ ซึ่งปัจจัยเหล่านี้กระตุ้นให้นักลงทุนโยกย้ายเงินทุนเข้าสินทรัพย์ที่ถูกมองว่าเป็น “หลุมหลบภัย” (safe haven) เช่น ทองคำ ส่งผลให้ราคาทองคำมีแนวโน้มผันผวนและตอบสนองต่อข่าวสารอย่างรวดเร็วและรุนแรงมากขึ้น ภายใต้บริบทดังกล่าว การพยากรณ์ราคาทองคำอย่างแม่นยำจึงมีความสำคัญอย่างยิ่ง ทั้งในเชิงการตัดสินใจลงทุน การบริหารความเสี่ยง และการกำหนดนโยบายเศรษฐกิจ

**โจทย์การวิเคราะห์:** หาวิธีที่เหมาะสมที่สุดในการพยากรณ์ราคาทองคำภายใต้สถานการณ์สงครามรัสเซีย-ยูเครน โดยเปรียบเทียบระหว่าง **"วิธี Time Series เทียบกับ Machine Learning** เพื่อให้ได้โมเดลที่สามารถนำไปประยุกต์ใช้ในการพยากรณ์เพื่อเป็นข้อมูลประกอบการตัดสินใจการลงทุนหรือการวางแผนนโยบายได้อย่างเหมาะสม

## Data

ข้อมูลที่ใช้เป็นข้อมูลราคาทองคำรายวัน ซึ่งประกอบด้วยราคาเปิด (Open) ราคาสูงสุด (High) ราคาต่ำสุด (Low) และราคาปิด (Close)

- การศึกษานี้สร้างตัวแบบโดยใช้ราคาปิด (Close)

## Methods

โมเดลที่ใช้ในการพยากรณ์มีดังนี้:

**1. Time Series Method (วิธีการอนุกรมเวลา)**

- **Holt's Exponential Smoothing**: ตัวแบบที่เหมาะสำหรับข้อมูลที่มีแนวโน้ม (Trend) สร้างตัวแบบโดยให้น้ำหนักกับข้อมูลล่าสุดมากกว่าข้อมูลเก่า

- **ARIMA (AutoRegressive Integrated Moving Average)**: ตัวแบบอนุกรมเวลาที่ได้รับความนิยม สามารถใช้ข้อมูลในอดีตเพื่อทำนายอนาคต โดยปรับโมเดลตามข้อมูลในอดีต (p) และปรับตามความคลาดเคลื่อน (q)

**2. Machine Learning Method (วิธีการเรียนรู้ของเครื่อง)**

- **LSTM (Long Short-Term Memory)**: เป็น Neural Network ที่มีหน่วยความจำที่สามารถอัพเดทได้ สามารถจดจำรูปแบบของข้อมูลในระยะยาวและระยะสั้นได้อย่างมีประสิทธิภาพได้ เหมาะสำหรับข้อมูลที่มีลำดับเวลา

- **XGBoost (Extreme Gradient Boosting)**: เป็นอัลกอริทึมต้นไม้ตัดสินใจแบบ Ensemble ที่ใช้โครงสร้างแบบต้นไม้หลายๆ ต้นมาช่วยกันทำนาย การใช้พยากรณ์ในงาน Regression ผลที่ได้มักมีความแม่นยำสูง สามารถประมวลผลได้เร็ว

## Tools

เครื่องมือและไลบรารีที่ใช้ในการวิเคราะห์และพัฒนาโมเดลแบ่งตามวิธีการดังนี้:

### Time Series Method (R)

สำหรับการวิเคราะห์ด้วยวิธีอนุกรมเวลา ใช้ภาษา **R** โดยมีไลบรารีหลักที่สำคัญต่อการวิเคราะห์ดังนี้:

- **forecast**: ใช้สำหรับการสร้างและพยากรณ์โมเดลอนุกรมเวลา Holt's Exponential Smoothing และ ARIMA
- **tseries**: ใช้ทดสอบความนิ่งของข้อมูล (Stationarity Test เช่น ADF test)
- **ggplot2**: ใช้สำหรับการสร้างกราฟและแสดงภาพข้อมูล (Data Visualization)
- **Metrics**: ใช้คำนวณค่าความผิดพลาดและวัดประสิทธิภาพของโมเดล (เช่น RMSE, MAE, MAPE)
- **car, lmtest**: ใช้ทดสอบสมมติฐานตรวจสอบความเหมาะสมของตัวแบบ ARIMA

### Learning Based Method (Python)

สำหรับการวิเคราะห์ด้วยวิธีการเรียนรู้ของเครื่อง (Machine Learning & Deep Learning) ใช้ภาษา **Python** โดยมีไลบรารีหลักดังนี้:

- **PyTorch**: ใช้สำหรับสร้างและเทรนโมเดล Deep Learning
- **XGBoost**: ใช้สำหรับสร้างโมเดล XGBoost
- **Skforecast**: ไลบรารีสำหรับการทำ Time Series Forecasting ด้วยโมเดล Machine Learning (เฉพาะ XGBoost)
- **Pandas**: ใช้จัดการข้อมูล
- **NumPy**: ใช้สำหรับการคำนวณคณิตศาสตร์
- **Matplotlib**: ใช้สำหรับพล็อตกราฟ (Data Visualization)

## Methodology

### Time Series Model

**1. Holt's Exponential Smoothing**

ขั้นตอนการสร้างโมเดล:

- ตรวจสอบความเหมาะสมโดยการพิจารณาลักษณะข้อมูล
- ประมาณค่าพารามิเตอร์
- พยากรณ์และวัดผล

**2. ARIMA (AutoRegressive Integrated Moving Average)**

ขั้นตอนการสร้างโมเดล:

- ตรวจสอบความนิ่งด้วย ADF-Test
- ตรวจสอบว่าข้อมูลนิ่งหรือไม่
- พิจารณา ACF และ PACF เพื่อกำหนดค่า p และ q
- ตรวจสอบความมีนัยสำคัญของพารามิเตอร์ในตัวแบบ
- ระบุสมการพยากรณ์
- ทดสอบความเหมาะสมของโมเดล
- พยากรณ์และวัดผล

### Machine Learning

**1. แนวทางการสร้างโมเดล**

**Lags Features**

ใช้ฟีเจอร์เป็น Lags Features (ข้อมูลย้อนหลัง) ตามความเหมาะสมของแต่ละโมเดล โดยนำค่าราคาทองคำในอดีตมาเป็นตัวแปรอิสระในการทำนาย

![Lags Feature](Pictures/Lags%20Feature.png)

**Multi-Step Direct Forecasting**

สร้างโมเดลพยากรณ์ด้วยกลยุทธ์ Multi-Step Direct Forecasting เพื่อให้การเปรียบเทียบเป็นธรรม โดยสร้างโมเดลแยกสำหรับแต่ละช่วงเวลาที่ต้องการทำนาย หลักการคือจะทำการสร้างโมเดลจำนวน 155 โมเดลพยากรณ์ที่เทรนด้วยข้อมูลฝึกเดียวกัน มาใช้ในการพยากรณ์ราคาทองคำในช่วงเวลา 155 วันข้างหน้า (ใช้ X เป็น Lags Features เดียวกันทั้งหมด แต่กำหนด Y ต่างกันตามวันเป้าหมายแต่ละโมเดล)

![Multi Step Direct Forecasting](Pictures/Multi%20step%20direct%20forecasting.png)

**Hyperparameter Tuning (การปรับแต่งพารามิเตอร์)**

สำหรับแต่ละวิธี Machine Learning ได้ทำการค้นหาชุดไฮเพอร์พารามิเตอร์ที่เหมาะสมที่สุดด้วยวิธี Grid Search แบบ Rolling Window เพื่อให้ได้โมเดลที่มีประสิทธิภาพสูงสุด

![Rolling Window CV](Pictures/Rolling%20Window%20CV.png)

**2. โมเดลที่ใช้**

- **LSTM (Long Short-Term Memory)**: เป็น Neural Network ที่มีหน่วยความจำที่สามารถอัพเดทได้ เหมาะสำหรับข้อมูลที่มีลำดับเวลา ใช้ไลบรารี PyTorch

- **XGBoost (Extreme Gradient Boosting)**: เป็นอัลกอริทึมต้นไม้ตัดสินใจ ใช้ไลบรารี Skforecast ซึ่งเป็นไลบรารีใน Python สำหรับทำ Time Series Forecasting โดยใช้โมเดล Machine Learning ทั่วไป

**3. การวัดผล**

ผลการทำนายจากวิธีการต่างๆ ถูกเปรียบเทียบโดยใช้เกณฑ์ดังนี้:

- **RMSE (Root Mean Square Error)**: ค่าวัดที่หากมีจุดที่ผิดพลาดเยอะจะทำให้ค่าโตไว
- **MAE (Mean Absolute Error)**: วัดความคลาดเคลื่อนโดยเฉลี่ย
- **MAPE (Mean Absolute Percentage Error)**: วัดความคลาดเคลื่อนเป็นเปอร์เซ็นต์

## Results

ผลการเปรียบเทียบประสิทธิภาพระหว่างวิธี Time Series กับ Machine Learning แสดงไว้ในไฟล์ผลลัพธ์ [Summarize Results.md](Summarize%20Results.md)

## Limitations

**ข้อจำกัดของการศึกษา:**

1. **โมเดล ARIMA(0,2,1)** ไม่ผ่านการทดสอบความเหมาะสมทางสถิติ ใช้เพื่อเปรียบเทียบประสิทธิภาพเท่านั้น ไม่ควรนำไปใช้ในการพยากรณ์จริง

2. **ข้อมูลมีจำนวนจำกัด** อาจทำให้ผลลัพธ์ของวิธี Machine Learning ยังไม่แสดงศักยภาพเต็มที่

3. **การออกแบบ Validation** ในการศึกษานี้พยายามออกแบบการ Validation ให้เหมือนตอนพยากรณ์ Test set มากที่สุด ด้วยการนำ Multi-Step Direct ไปใช้ในการประเมิน และกำหนดช่วงเวลาประเมินในแต่ละ Fold = 155 วัน (เท่ากับวันที่ต้องพยากรณ์ Test set) ซึ่งทำให้การ Rolling Window จำนวน 5 Fold จำเป็นต้องออกแบบให้ช่วงเวลามีการซ้อนทับกัน อาจทำให้ผลของแต่ละ Fold มีความสัมพันธ์ต่อกัน (ข้อมูลไม่เพียงพอสำหรับการแบ่งแต่ละ Fold ให้แยกจากกัน)

   อย่างไรก็ตาม การเปรียบเทียบนี้มีจุดประสงค์เพื่อหาวิธีการพยากรณ์ราคาทองคำในสถานการณ์วิกฤติในอนาคต สำหรับการพยากรณ์ในสถานการณ์ปกติที่สามารถเก็บรวบรวมข้อมูลได้มากขึ้น ผลลัพธ์ไฮเพอร์พารามิเตอร์ของวิธี Machine Learning ที่ได้อาจมีค่าแตกต่างออกไป เมื่อมีการออกแบบให้การหาไฮเพอร์พารามิเตอร์ด้วยวิธี Rolling Window CV มีความสมบูรณ์มากยิ่งขึ้น

4. **ผลลัพธ์ของวิธี Machine Learning** มีความแตกต่างชัดเจนระหว่างความแม่นยำของการ Validation และการประเมินบน Test set ควรมีการพิจารณาเพิ่มข้อมูลหรือปรับช่วงการ Grid Search

5. **ชุดไฮเพอร์พารามิเตอร์** ที่นำมาใช้ในการศึกษานี้ได้กำหนดให้มีความแตกต่างเบื้องต้นในแต่ละรอบการหา ไม่สามารถกำหนดให้มีความหลากหลายขึ้นได้เนื่องจากขาดทรัพยากรในการคำนวณ ควรมีการขยายช่วงการหาไฮเพอร์พารามิเตอร์เพื่อให้ผลลัพธ์ที่ได้สมบูรณ์ยิ่งขึ้น

## Recommendations & Next Steps

**ข้อเสนอแนะและแนวทางการพัฒนาต่อยอด:**

- **Model Selection**: เลือกโมเดลที่พยากรณ์ได้ดีที่สุดบน Test set เพื่อนำไปใช้งานจริง

- **Ensemble Methods**: อาจพิจารณาผสมผสานวิธีต่างๆ เข้าด้วยกัน (Ensemble) เช่น รวมผลการทำนายจาก LSTM และ XGBoost เพื่อให้ได้ผลการทำนายที่ดีขึ้น

- **Real-time Implementation**: สามารถนำตัวแบบที่ดีที่สุดไปพัฒนาเป็นระบบพยากรณ์ราคาทองคำแบบเรียลไทม์

- **Data Collection**: เก็บรวบรวมข้อมูลเพิ่มเติมเพื่อปรับปรุงประสิทธิภาพของวิธี Machine Learning

- **Exogenous Variables**: ควรเพิ่มตัวแปรภายนอก เช่น อัตราแลกเปลี่ยน ราคาน้ำมัน หรืออัตราดอกเบี้ย โดยเปลี่ยนไปใช้โมเดล ARIMAX แทนโมเดล ARIMA หรือและเพิ่ม feature ในโมเดล Machine Learning เพื่อช่วยเพิ่มความแม่นยำในการพยากรณ์

## Project Structure

สามารถดูรายละเอียดโค้ดและการวิเคราะห์ทั้งหมดได้ในไฟล์ Jupyter Notebook ที่เกี่ยวข้อง

```
├── README.md                                    <- ไฟล์อธิบายภาพรวมโปรเจกต์
├── Lags Feature.png                             <- รูปอธิบาย Lags Features
├── Rolling Window CV.png                        <- รูปอธิบายวิธี Rolling Window Cross-Validation
├── Multi step direct forecasting.png            <- รูปอธิบายกลยุทธ์ Multi-Step Direct Forecasting
├── Result.png                                   <- กราฟแสดงผลการพยากรณ์บน Test set
│
├── Time Series Method/
│   ├── ARIMA.ipynb                              <- การวิเคราะห์และพยากรณ์ด้วย ARIMA
│   └── Holt's Exponential Smoothing.ipynb       <- การวิเคราะห์และพยากรณ์ด้วย Holt's ES
│
├── Learning Based/
│   ├── LSTM/
│   │   ├── LSTM Forecasting.ipynb               <- การพยากรณ์ด้วย LSTM (ใช้พารามิเตอร์ที่ดีที่สุด)
│   │   └── LSTM grid search.ipynb               <- การหาไฮเพอร์พารามิเตอร์ที่เหมาะสมสำหรับ LSTM
│   │
│   └── XGBoost/
│       ├── XGBoost Forecasting.ipynb            <- การพยากรณ์ด้วย XGBoost (ใช้พารามิเตอร์ที่ดีที่สุด)
│       └── XGBoost grid search.ipynb            <- การหาไฮเพอร์พารามิเตอร์ที่เหมาะสมสำหรับ XGBoost
│
└── Summarize Results.md                         <- สรุปและเปรียบเทียบประสิทธิภาพของทุกวิธี
```
